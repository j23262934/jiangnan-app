<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ±Ÿå—çŸ¥åºœ v17.2</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        /* --- 1. æ ¸å¿ƒè®Šæ•¸ --- */
        :root {
            --bg-body: #F2F2F7;
            --bg-card: #FFFFFF;
            --bg-input: #E3E3E8;
            --text-main: #1C1C1E;
            --text-sub: #8E8E93;
            --primary: #5dabff;
            --primary-grad: linear-gradient(135deg, #a3bded 0%, #6991c7 100%);
            --danger: #FF3B30;
            --success: #34C759;
            --rank-tian: #fab75a;
            --rank-hou: #5a9ffa;
            --rank-qing: #8fe09d;
            --rank-shi: #A0A0A5;
            --radius-m: 12px;
            --radius-l: 18px;
            --radius-xl: 24px;
            --shadow: 0 4px 20px rgba(0,0,0,0.06);
            --bottom-nav-height: 80px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif;
            background-color: var(--bg-body); margin: 0; color: var(--text-main); height: 100vh;
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- æç¤ºèˆ‡ç¢ºèªå¡ç‰‡ --- */
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 3000; pointer-events: none; }
        .toast { background: rgba(28, 28, 30, 0.9); color: #fff; padding: 10px 20px; border-radius: 30px; font-size: 0.9rem; font-weight: 500; margin-bottom: 10px; backdrop-filter: blur(10px); animation: toastIn 0.3s ease-out forwards; }
        @keyframes toastIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        #confirm-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.3); z-index: 2000; opacity: 0; pointer-events: auto; transition: 0.3s; backdrop-filter: blur(2px); display: none; }
        #confirm-overlay.open { display: block; opacity: 1; }
        #confirm-card { position: fixed; top: 0; left: 50%; transform: translate(-50%, -150%); width: 90%; max-width: 400px; background: #fff; border-radius: 24px; padding: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); z-index: 2100; transition: transform 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.1); }
        #confirm-card.open { transform: translate(-50%, 20px); }
        .confirm-title { font-weight: 800; margin-bottom: 8px; font-size: 1.2rem; text-align: center; }
        .confirm-msg { color: var(--text-sub); font-size: 0.95rem; margin-bottom: 20px; text-align: center; line-height: 1.5; }

        /* --- é ‚éƒ¨å°èˆª --- */
        header { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); z-index: 10; padding-bottom: 8px; border-bottom: 1px solid rgba(0,0,0,0.05); flex-shrink: 0; }
        .app-title { text-align: center; font-size: 1.1rem; font-weight: 700; padding: 12px 0 8px 0; }
        .city-scroll { display: flex; width: 100%; padding: 0 15px; gap: 8px; overflow-x: auto; scrollbar-width: none; }
        .city-scroll::-webkit-scrollbar { display: none; }
        .city-tab { flex-shrink: 0; padding: 8px 18px; border-radius: 30px; color: var(--text-sub); font-size: 0.9rem; font-weight: 700; cursor: pointer; transition: 0.2s; white-space: nowrap; }
        .city-tab.active { background: var(--text-main); color: #fff; }
        .city-tab.special-tab { color: var(--primary); background: rgba(0, 122, 255, 0.08); }
        .city-tab.special-tab.active { background: var(--primary-grad); color: #fff; }

        main { flex: 1; overflow-y: auto; padding: 20px 20px 110px 20px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; width: 100%; }
        .subtitle { font-size: 1.5rem; font-weight: 800; }
        .btn-action { background: var(--primary-grad); color: white; border: none; border-radius: 30px; padding: 8px 18px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: transform 0.1s; flex-shrink: 0; }

        .search-container { margin-bottom: 20px; position: relative; }
        .search-input-main { width: 100%; padding: 12px 16px 12px 42px; border: none; background: #FFFFFF; border-radius: 12px; font-size: 1rem; box-shadow: var(--shadow); }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-sub); }

        .view-section { display: none; opacity: 0; animation: fadeIn 0.3s forwards; }
        .view-section.active { display: block; }
        @keyframes fadeIn { to { opacity: 1; } }

        /* --- å¡ç‰‡æ¨£å¼ (å…©æ¬„å„ªåŒ–) --- */
        .card-base { background: var(--bg-card); border-radius: var(--radius-l); padding: 12px; box-shadow: var(--shadow); margin-bottom: 10px; transition: 0.2s; position: relative; overflow: hidden; cursor: pointer; }
        
        .char-grid, .building-list { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 10px; 
        }

        .rank-tag { font-size: 0.65rem; font-weight: 700; padding: 2px 6px; border-radius: 20px; color: #fff; }
        .bg-å¤© { background: var(--rank-tian); } .bg-ä¾¯ { background: var(--rank-hou); } .bg-å¿ { background: var(--rank-qing); } .bg-å£« { background: var(--rank-shi); }
        
        .char-talent { font-size: 0.75rem; color: var(--text-sub); line-height: 1.4; background: #F9F9FB; padding: 8px; border-radius: var(--radius-m); margin-top: 6px; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
        .talent-hl { color: var(--primary); font-weight: 800; }

        .stats-row { display: flex; justify-content: space-between; margin-top: 8px; flex-wrap: wrap; gap: 2px; }
        .stat-box { display: flex; flex-direction: column; align-items: center; flex: 1; min-width: 25px; }
        .stat-label { font-size: 0.6rem; color: #B0B0B5; }
        .stat-val { font-size: 0.85rem; font-weight: 600; }
        .stat-high { color: var(--primary); font-weight: 800; }
        .stat-ultra { color: #FF9500; font-weight: 800; }

        /* --- å»ºç¯‰æ¨£å¼ (å…©æ¬„å„ªåŒ–) --- */
        .building-card { display: flex; flex-direction: column; align-items: flex-start; gap: 6px; padding: 12px 10px 10px 16px; position: relative; }
        .b-color-strip { position: absolute; left: 0; top: 0; bottom: 0; width: 5px; }
        .b-info { width: 100%; min-width: 0; }
        .b-name { font-weight: 700; font-size: 0.9rem; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .b-desc { font-size: 0.75rem; color: var(--text-sub); display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .btn-distribute { width: 100%; margin-top: 4px; color: #443c3c; background: #F2F2F7; border: none; border-radius: 20px; padding: 5px 0; font-size: 0.75rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 2px; }

        /* --- æ¦‚æ³å°ˆç”¨ç·Šæ¹Šæ¨£å¼ --- */
        .overview-divider { margin: 25px 0 12px 0; font-size: 0.85rem; font-weight: 700; color: var(--text-main); display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none; }
        .ov-count-tag { font-size: 0.7rem; background: #E5E5EA; color: #8E8E93; padding: 2px 8px; border-radius: 10px; font-weight: normal; }
        .ov-toggle-icon { font-size: 1.2rem; transition: transform 0.3s; color: var(--text-sub); margin-left: auto; }
        .ov-divider-collapsed .ov-toggle-icon { transform: rotate(-90deg); }
        
        .ov-collapsible-content { overflow: hidden; transition: max-height 0.3s ease-out; }
        .ov-collapsible-content.collapsed { max-height: 0 !important; }

        .ov-char-grid, .ov-build-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding-bottom: 5px; }
        .ov-char-card { padding: 12px !important; margin-bottom: 0 !important; }
        .ov-char-card .stats-row { display: none; } 
        .ov-char-card .char-name { font-size: 0.9rem; }
        .ov-char-card .char-talent { font-size: 0.75rem; padding: 6px; margin-top: 6px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        .ov-build-card { padding: 10px 10px 10px 16px !important; margin-bottom: 0 !important; min-height: 44px; flex-direction: row; }
        .ov-build-card .b-desc { display: none; } 
        .ov-build-card .b-name { font-size: 0.85rem; }

        /* åº•éƒ¨å°èˆª */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: var(--bottom-nav-height); background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); border-top: 1px solid rgba(0,0,0,0.05); display: flex; justify-content: space-around; align-items: center; z-index: 50; padding-bottom: 15px; }
        .nav-item { flex: 1; text-align: center; color: #C7C7CC; font-size: 0.75rem; cursor: pointer; }
        .nav-item.active { color: var(--text-main); }
        .nav-icon { display: block; width: 24px; height: 24px; margin: 0 auto 4px auto; fill: currentColor; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); z-index: 100; backdrop-filter: blur(4px); display: flex; justify-content: center; align-items: flex-end; padding-bottom: 30px; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }
        .modal-box { background: #fff; width: 95%; max-width: 500px; border-radius: var(--radius-xl); padding: 30px 24px; max-height: 85vh; overflow-y: auto; transform: translateY(100%); transition: 0.3s; }
        .modal-overlay.open .modal-box { transform: translateY(0); }
        .modal-title { font-size: 1.25rem; font-weight: 800; margin-bottom: 20px; text-align: center; }
        
        .edit-group-v { margin-bottom: 20px; }
        .edit-label { font-size: 0.85rem; color: var(--text-sub); font-weight: 600; margin-bottom: 8px; display: block; }
        .text-input, .talent-input, .select-input { width: 100%; padding: 14px; border: none; background: var(--bg-input); border-radius: 12px; font-size: 1rem; color: var(--text-main); }
        
        .suggestion-container { position: absolute; top: 100%; left: 0; right: 0; background: #fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); z-index: 1001; display: none; max-height: 200px; overflow-y: auto; border: 1px solid #eee; }
        .suggestion-item { padding: 14px 16px; border-bottom: 1px solid #f2f2f7; cursor: pointer; display: flex; justify-content: space-between; }
        
        .stat-inputs { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .stat-input-wrap input { width: 100%; text-align: center; padding: 12px 0; border: none; background: var(--bg-input); border-radius: 12px; font-weight: 700; }
        
        .city-dispatch-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .dispatch-btn { padding: 12px; border: none; background: var(--bg-input); border-radius: 12px; font-weight: 600; cursor: pointer; border: 2px solid transparent; }
        .dispatch-btn.selected { background: #EAF2FF; color: var(--primary); border-color: var(--primary); }

        .action-btns { margin-top: 25px; display: flex; gap: 12px; }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 16px; font-weight: 700; cursor: pointer; }
        .btn-cancel { background: #F2F2F7; color: var(--text-sub); }
        .btn-save-full { background: var(--primary-grad); color: white; }
        .btn-delete { background: #FFF0F0; color: var(--danger); width: 100%; margin-top: 15px; }

        .color-picker-wrapper { flex: 0 0 50px; text-align: center; }
        .circular-color-picker { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; border: 3px solid #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: relative; cursor: pointer; margin: 0 auto; }
        .circular-color-picker input[type="color"] { position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; cursor: pointer; opacity: 0; }
    </style>
</head>
<body>

    <div id="toast-container"></div>
    <div id="confirm-overlay" onclick="handleConfirm(false)"></div>
    <div id="confirm-card">
        <div class="confirm-title" id="confirm-title">ç¢ºèª</div>
        <div class="confirm-msg" id="confirm-msg"></div>
        <div style="display:flex; gap:12px;">
            <button class="btn btn-cancel" onclick="handleConfirm(false)">å–æ¶ˆ</button>
            <button class="btn btn-save-full" style="background:var(--danger);" id="confirm-ok-btn" onclick="handleConfirm(true)">ç¢ºå®š</button>
        </div>
    </div>

    <header>
        <div class="app-title">æ±Ÿå—çŸ¥åºœ v17.2</div>
        <nav class="city-scroll" id="cityTabs"></nav>
    </header>

    <main>
        <div id="view-people" class="view-section active">
            <div class="section-header">
                <div class="subtitle">äººå“¡</div>
                <button class="btn-action" onclick="openAddCharModal()">ï¼‹ æ–°å¢</button>
            </div>
            <div class="search-container">
                <span class="material-symbols-outlined search-icon">search</span>
                <input type="text" id="searchInput" class="search-input-main" placeholder="æœå°‹å§“å..." oninput="renderPeople()">
            </div>
            <div id="charList" class="char-grid"></div>
        </div>

        <div id="view-city" class="view-section">
            <div class="section-header">
                <div class="subtitle" id="build-subtitle">å»ºç¯‰å€‰åº«</div>
                <button id="addBuildBtn" class="btn-action" onclick="openAddBuildingModal()">ï¼‹ æ–°å¢åŸå‹</button>
            </div>
            <div id="buildingList" class="building-list"></div>
        </div>

        <div id="view-overview" class="view-section">
            <div class="section-header"><div class="subtitle">å·åºœç¸½è¦½</div></div>
            <div id="overview-content"></div>
            <button class="btn btn-save-full" style="background:var(--success); color:#fff; width:100%; margin-top:40px; border-radius:16px;" onclick="openDataModal()">ğŸ’¾ æ•¸æ“šå‚™ä»½ / é‚„åŸ</button>
        </div>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('people')"><svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><div>äººç‰©</div></div>
        <div class="nav-item" onclick="switchTab('city')"><svg class="nav-icon" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4 0h2v7h-2zm4 0h2v7h-2z"/></svg><div>å»ºç¯‰</div></div>
        <div class="nav-item" onclick="switchTab('overview')"><svg class="nav-icon" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg><div>æ¦‚æ³</div></div>
    </nav>

    <!-- Modals -->
    <div class="modal-overlay" id="charModal">
        <div class="modal-box">
            <div class="modal-title" id="charModalTitle">ç·¨è¼¯äººç‰©</div>
            <div class="field-row" style="display:flex; gap:12px; margin-bottom:15px; align-items:flex-end;">
                <div class="edit-group" style="flex:1; position:relative;">
                    <label class="edit-label">å§“å</label>
                    <input type="text" id="in-c-name" class="text-input" oninput="handleNameInput()" autocomplete="off">
                    <div id="suggestionBox" class="suggestion-container"></div>
                </div>
                <div class="edit-group" style="flex:0 0 100px;">
                    <label class="edit-label">éšç´š</label>
                    <select id="in-c-rank" class="select-input">
                        <option value="å¤©">å¤©</option><option value="ä¾¯">ä¾¯</option><option value="å¿">å¿</option><option value="å£«">å£«</option>
                    </select>
                </div>
            </div>
            <div class="edit-group-v">
                <label class="edit-label">äº”ç¶­å±¬æ€§</label>
                <div class="stat-inputs">
                    <div class="stat-input-wrap"><input type="number" id="in-c-build"></div>
                    <div class="stat-input-wrap"><input type="number" id="in-c-farm"></div>
                    <div class="stat-input-wrap"><input type="number" id="in-c-make"></div>
                    <div class="stat-input-wrap"><input type="number" id="in-c-money"></div>
                    <div class="stat-input-wrap"><input type="number" id="in-c-adv"></div>
                </div>
            </div>
            <div class="edit-group-v">
                <label class="edit-label">èƒ½åŠ› [ ] é«˜äº®</label>
                <textarea id="in-c-talent" class="talent-input" rows="2"></textarea>
            </div>
            <div class="edit-group-v">
                <label class="edit-label">æ‰€åœ¨åœ°</label>
                <div class="city-dispatch-grid" id="modalCityGrid"></div>
            </div>
            <div class="action-btns">
                <button class="btn btn-cancel" onclick="closeModal('charModal')">å–æ¶ˆ</button>
                <button class="btn btn-save-full" onclick="saveChar()">å„²å­˜</button>
            </div>
            <button id="btn-delete-char" class="btn btn-delete" onclick="askDeleteChar()">åˆªé™¤æ­¤äºº</button>
        </div>
    </div>

    <div class="modal-overlay" id="buildingModal"><div class="modal-box"><div class="modal-title" id="buildModalTitle">åŸå‹è¨­å®š</div><div class="field-row" style="display:flex; gap:12px; margin-bottom:15px; align-items:flex-end;"><div class="edit-group" style="flex:1;"><label class="edit-label">åç¨±</label><input type="text" id="in-b-name" class="text-input"></div><div class="color-picker-wrapper"><label class="edit-label">é¡è‰²</label><div class="circular-color-picker" id="color-circle"><input type="color" id="in-b-color" oninput="document.getElementById('color-circle').style.background=this.value"></div></div></div><div class="edit-group-v"><label class="edit-label">å‚™è¨»</label><input type="text" id="in-b-desc" class="text-input"></div><div class="action-btns"><button class="btn btn-cancel" onclick="closeModal('buildingModal')">å–æ¶ˆ</button><button class="btn btn-save-full" onclick="saveMasterBuilding()">å„²å­˜</button></div><button id="btn-delete-build" class="btn btn-delete" onclick="askDeleteBuild()">é€£é–åˆªé™¤</button></div></div>
    <div class="modal-overlay" id="distributeModal"><div class="modal-box"><div class="modal-title">åˆ†é…è‡³å·åºœ</div><div class="city-dispatch-grid" id="distCityGrid"></div><div class="action-btns"><button class="btn btn-cancel" onclick="closeModal('distributeModal')">å–æ¶ˆ</button><button class="btn btn-save-full" onclick="confirmDistribution()">ç¢ºèªåˆ†é…</button></div></div></div>
    <div class="modal-overlay" id="dataModal"><div class="modal-box"><div class="modal-title">æ•¸æ“šæ“ä½œ</div><textarea id="data-area" class="text-input" style="height:200px; font-size:0.8rem; font-family:monospace;"></textarea><div class="action-btns"><button class="btn btn-cancel" onclick="copyData()">è¤‡è£½</button><button class="btn btn-save-full" onclick="importData()">å°å…¥</button></div></div></div>

    <script>
        const charDB = {
            "æ²ˆå‘¨": { rank: "å¤©", talent: "åœ¨[å•†æ¥­å»ºç¯‰]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[20%]é€²åº¦ï¼Œä¸”[ç„¡éœ€]å·¥äººã€‚", stats: { build: 241, farm: 433, make: 608, money: 778, adv: 612 }, }, 
            "é¦®å«½": { rank: "ä¾¯", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œæ¡é›†æ¤ç‰©é«”åŠ›æ¶ˆè€—[-12%]ï¼Œä¸”é«”åŠ›æ¢å¾©é€Ÿåº¦åŠ å¿«[12%]ã€‚" }, 
            "è¢æ¾„": { rank: "ä¾¯", talent: "è² è²¬2å°æ™‚ä»¥ä¸Š[ç†è²¡]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[3%]é€²åº¦ï¼Œä¸¦éš¨æ©Ÿç²å¾—[2æœ¬]æ›¸ç±ã€‚" },
            "å¤å‰ªæ˜¥": { rank: "ä¾¯", talent: "[æ™šä¸Š]åœ¨[ç”Ÿç”¢æˆ–å•†æ¥­å»ºç¯‰]å·¥ä½œæ™‚ï¼Œè”å³å®Œæˆ[5%]é€²åº¦ã€‚" },
            "æº«åº­ç­ ": { rank: "ä¾¯", talent: "[æ¢ç´¢æ–°å€åŸŸ]æ™‚ï¼Œéœ€è¦æœ¬é‡‘æ¸›å°‘[5%]ï¼Œä½†æ‰€éœ€å·¥äºº[+3]ã€‚" },
            "æ–‡ç°¡": { rank: "ä¾¯", talent: "è² è²¬1å°æ™‚ä»¥ä¸Š[è£½ä½œ]å·¥ä½œæ™‚ï¼Œæ‰€éœ€è³‡æºæ¸›å°‘[5%]ï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚" },
            "æ¡ƒæœµå…’": { rank: "ä¾¯", talent: "å…¥ä½çš„åŸå¸‚å°å‹•ç‰©å‡ºç¾æ¦‚ç‡æå‡[5%]ï¼Œä¸¦æœƒåœ¨[ç©ºé–’]ä¸”[æŠ•é£Ÿæ§½åŠæ»¿]æ™‚ä¸»å‹•æ¸…ç†ã€‚" }, 
            "è˜‡è½": { rank: "ä¾¯", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œæœƒæœ‰å±…æ°‘ä¸»å‹•å¹«åŠ©ï¼Œæ¯æ¬¡æ¡é›†æ¤ç‰©ç²å¾—[2å€]è³‡æºï¼Œä½†æ¶ˆè€—[1.8å€]é«”åŠ›ã€‚" }, 
            "è«é‚ª": { rank: "ä¾¯", talent: "åœ¨[ç¢¼é ­]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[10%]é€²åº¦ã€‚èˆ‡[å¹²å°‡]å…¥ä½åŒåŸå¸‚æ™‚ï¼Œé¡å¤–å®Œæˆ[10%]é€²åº¦ã€‚" }, 
            "é«˜èˆ": { rank: "ä¾¯", talent: "[æ¢ç´¢æ–°å€åŸŸ]æ™‚ï¼Œè”å³å®Œæˆ[2%]é€²åº¦ï¼Œä¸”æ‰€éœ€æœ¬é‡‘æ¸›å°‘[2%]ã€‚" }, 
            "æå†¶": { rank: "ä¾¯", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œæ¡é›†æ¤ç‰©é«”åŠ›æ¶ˆè€—[-2]ï¼Œä¸”ä¸¦é¡å¤–ç²å¾—1å€‹éš¨æ©Ÿç¤¦ç‰©ã€‚" }, 
            "èŠ±æ™šç…§": { rank: "ä¾¯", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œæ¡é›†æ¤ç‰©é«”åŠ›æ¶ˆè€—[-10%]ï¼Œä¸”ä¸¦é¡å¤–ç²å¾—1å€‹éš¨æ©ŸèŠ±å‰ã€‚" }, 
            "ç‹„ä»å‚‘": { rank: "å¿", talent: "[å»ºé€ æˆ–å‡ç´šå»ºç¯‰]æ™‚ï¼Œç«‹å³å®Œæˆ[10%]é€²åº¦ã€‚", }, 
            "é™³éš¨": { rank: "å¿", talent: "åœ¨[é€ ç´™å» ã€æ²¹ç´™å» ]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[12%]é€²åº¦ã€‚", }, 
            "æå¸«å¸«": { rank: "å¿", talent: "åœ¨[ç•«å®¤]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[25ä»½]å¸ƒ", }, 
            "ä¸˜é˜¿èŠ¥": { rank: "å¿", talent: "å…¥ä½åŸå¸‚å¾Œï¼Œæœƒåœ¨[ç©ºé–’]æ™‚å®‰è‘¬å»ä¸–å±…æ°‘ï¼Œä¸”æ‰€éœ€éŠ…éŒ¢[-6%]ã€‚", }, 
            "å…ƒåœæ„": { rank: "å¿", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œæ¡é›†ä»»æ„ç‰©é«”å¾Œï¼Œé¡å¤–ç²å¾—[25]éŠ…éŒ¢ã€‚", }, 
            "è–›ç´ ç´ ": { rank: "å¿", talent: "åœ¨[ç¹¡åŠ]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[100éŠ…éŒ¢]ã€‚", }, 
            "è‘£å¤«äºº": { rank: "å¿", talent: "è² è²¬[è£½ä½œ]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[15%]é€²åº¦ã€‚", }, 
            "è˜‡å°å¦¹": { rank: "å¿", talent: "åœ¨[å•†æ¥­å»ºç¯‰]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[20%]é€²åº¦ï¼Œä½†æ‰€éœ€å·¥äºº[+1]ã€‚", }, 
            "æ¹¯é¡¯ç¥–": { rank: "å¿", talent: "åœ¨[å•†æ¥­å»ºç¯‰]å·¥ä½œæ™‚ï¼Œæ‰€éœ€æœ¬é‡‘æ¸›å°‘[60%]ã€‚", }, 
            "æ²ˆè¬åƒ": { rank: "å¿", talent: "[æ¢ç´¢æ–°å€åŸŸ]æ™‚ï¼Œæ‰€éœ€æœ¬é‡‘æ¸›å°‘[10%]ã€‚", }, 
            "æœç”«": { rank: "å¿", talent: "[å‡ç´šå»ºç¯‰]æ™‚ï¼Œæ‰€éœ€éŠ…éŒ¢æ¸›å°‘[20%]ã€‚", }, 
            "é«˜å„ª": { rank: "å£«", talent: "åœ¨[æŠ•é£Ÿæ§½]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[50%]é€²åº¦ã€‚", }, 
            "è¬æˆ¶": { rank: "å£«", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œå»ºé€ ã€ä¿®å¾©ç‰©é«”çš„é«”åŠ›æ¶ˆè€—[-10]ã€‚", }, 
            "é¦¬æ–‡æ‰": { rank: "å£«", talent: "åœ¨[å•†æ¥­å»ºç¯‰]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[9]éŠ…éŒ¢ã€‚", }, 
            "æŸ¯æœ‰æ¨µ": { rank: "å£«", talent: "å…¥ä½åŸå¸‚å¾Œï¼Œæœƒåœ¨[ç©ºé–’]æ™‚æ¸…ç†åŸä¸­æ¯æï¼Œä¸¦é¡å¤–ç²å¾—[+6]ç¶“é©—æ¤ã€‚", }, 
            "å²ç«‹æ¸…": { rank: "å£«", talent: "å…¥ä½åŸå¸‚å¾Œï¼Œæœƒåœ¨[ç©ºé–’]ä¸”[æŠ•é£Ÿæ§½åŠæ»¿]æ™‚ä¸»å‹•æ¸…ç†ï¼Œä¸¦ç«‹å³å®Œæˆ[30%]é€²åº¦ã€‚", }, 
            "è¿…å¨ƒå…’": { rank: "å¿", talent: "[å¤–å‡ºæ¢éšª]æ™‚ï¼Œæ¡é›†æ¤ç‰©çš„é«”åŠ›æ¶ˆè€—[-2]ï¼Œä¸¦é¡å¤–ç²å¾—[7]éŠ…éŒ¢ã€‚", }, 
            "é§±å•æ©Ÿ": { rank: "å¿", talent: "å…¥ä½åŸå¸‚ä¸­ï¼Œæ‰€æœ‰[æ°‘å®…]éŠ…éŒ¢ç”¢é‡å¢åŠ [50%]ã€‚", }, 
            "å®‹æ‡‰å‡": { rank: "å¿", talent: "åœ¨[éŠ…é¡åº—]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[60ä»½]æµ·æœˆæ®¼ã€‚", stats: { build: 87, farm: 246, make: 255, money: 607, adv: 437 }, }, 
            "éº—å¨˜": { rank: "å¿", talent: "åœ¨[ç¹”å¸ƒåŠ]å·¥ä½œæ™‚ï¼Œéœ€è¦æ£‰èŠ±æ¸›å°‘[90%]ã€‚", stats: { build: 66, farm: 243, make: 620, money: 439, adv: 249 }, }, 
            "é¦®å¤¢é¾": { rank: "å¿", talent: "[å»ºé€ å¨›æ¨‚å»ºç¯‰]æ™‚ï¼Œç«‹å³å®Œæˆ[15%]é€²åº¦ã€‚", stats: { build: 225, farm: 64, make: 225, money:225, adv: 562 }, }, 
            "è¶éš±å¨˜": { rank: "å¿", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œå»ºé€ ã€ä¿®å¾©ç‰©é«”é«”åŠ›æ¶ˆè€—æ¸›å°‘[50%]ã€‚", stats: { build: 168, farm: 69, make: 81, money: 69, adv: 407 }, }, 
            "æ–‡æ¼¢å„’": { rank: "å¿", talent: "åœ¨[å•†æ¥­å»ºç¯‰]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ10%é€²åº¦ã€‚", stats: { build: 242, farm: 63, make: 212, money: 431, adv: 63 }, }, 
            "æœç§‹å¨˜": { rank: "å¿", talent: "è² è²¬1å°æ™‚ä»¥ä¸Š[è£½ä½œ]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[30ä»½]èœé¤šã€‚", stats: { build: 259, farm: 259, make: 443, money: 67, adv: 67 }, }, 
            "å°è »": { rank: "å¿", talent: "åœ¨[ç«¹æ—]å·¥ä½œæ™‚ï¼Œç«¹å­ç”¢é‡æå‡[30%]ã€‚", stats: { build: 445, farm: 621, make: 261, money: 98, adv: 91 }, }, 
            "é™¶å§œ": { rank: "å¿", talent: "åœ¨[é¦™ç²‰å» ]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[10%]è³‡æºã€‚", stats: { build: 89, farm: 244, make: 440, money: 259, adv: 67 }, }, 
            "ç§¦å­æ£ ": { rank: "å¿", talent: "è² è²¬1å°æ™‚ä»¥ä¸Š[ç†è²¡]å·¥ä½œæ™‚ï¼Œéœ€è¦æœ¬é‡‘æ¸›å°‘[50%]ï¼Œä¸”éŠ…éŒ¢æ”¶å…¥å¢åŠ [15%]ã€‚", stats: { build: 244, farm: 67, make: 89, money: 431, adv: 96 }, }, 
            "å¤§å’Œæ’«å­": { rank: "å¿", talent: "åœ¨[é­šå¡˜ã€èŸ¹å¡˜]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[30ä»½]è‚‰é¡ã€‚", stats: { build: 247, farm: 618, make: 93, money: 241, adv: 428 }, }, 
            "è¢å¯ç«‹": { rank: "ä¾¯", talent: "åœ¨[é­šå¡˜ã€èŸ¹å¡˜]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[6%]é€²åº¦ã€‚", stats: { build: 255, farm: 608, make: 430, money: 418, adv: 605 }, }, 
            "æ…•å§£å§£": { rank: "ä¾¯", talent: "[å¤–å‡ºæ¢éšª]æ™‚ï¼Œæ¡é›†æ‰€æœ‰ç‰©é«”çš„é«”åŠ›æ¶ˆè€—[-3]ã€‚", stats: { build: 22, farm: 108, make: 136, money: 50, adv: 347 }, }, 
            "æ­¦é³´æœˆ": { rank: "ä¾¯", talent: "åœ¨[éŒ¦ç¹¡é£¾åŠ]å·¥ä½œæ™‚ï¼Œé¦–é£¾ç”¢é‡å¢åŠ [5%]ã€‚", stats: { build: 88, farm: 95, make: 786, money: 246, adv: 95 }, }, 
            "æœ¨å¢": { rank: "ä¾¯", talent: "[å»ºé€ æ–°ç”Ÿç”¢å»ºç¯‰]æ™‚ï¼Œç«‹å³å®Œæˆ[6%]é€²åº¦ã€‚", stats: { build: 174, farm: 153, make: 103, money: 174, adv: 32 }, }, 
            "å¼µèˆŸå¸«": { rank: "ä¾¯", talent: "[å»ºé€ æˆ–å‡ç´šæ°´ä¸Šå»ºç¯‰æˆ–èˆ¹éš»]æ™‚ï¼Œç«‹å³å®Œæˆ[15%]é€²åº¦ã€‚", stats: { build: 603, farm: 428, make: 244, money: 64, adv: 434 }, }, 
            "é˜¿æœµ": { rank: "ä¾¯", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œæ¡é›†æ¤ç‰©çš„é«”åŠ›æ¶ˆè€—[-7]ã€‚", stats: { build: 69, farm: 106, make: 407, money: 91, adv: 150 }, }, 
            "æœç‰§": { rank: "ä¾¯", talent: "å»ºé€ [å¨›æ¨‚å»ºç¯‰]æ™‚ï¼Œæ‰€éœ€è³‡æºæ¶ˆè€—æ¸›å°‘[10%]ã€‚", stats: { build: 510, farm: 340, make: 77, money: 490, adv: 197 }, }, 
            "æ—è¡›æœ¨": { rank: "ä¾¯", talent: "åœ¨[æ—å ´ã€ç«¹æ—ã€æ¡æ²¹å» ã€æ¼†æ¨¹æ—]å·¥ä½œæ™‚ï¼Œè”å³å®Œæˆ[8%]é€²åº¦ã€‚", stats: { build: 324, farm: 454, make: 228, money: 78, adv: 296 }, }, 
            "æ¢å±±ä¼¯": { rank: "ä¾¯", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œæ¡é›†ä»»æ„ç‰©é«”ï¼Œå¯ç²å¾—ç­‰åŒæ–¼é«”åŠ›[20%]éŠ…éŒ¢æ”¶å…¥ã€‚", stats: { build: 235, farm: 166, make: 356, money: 104, adv: 235 }, }, 
            "ç››ç¾½æ—": { rank: "ä¾¯", talent: "è² è²¬1å°æ™‚ä»¥ä¸Š[å»ºé€ ]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[10%]é€²åº¦ï¼Œæ‰€éœ€èœé¤šæ¸›å°‘[8%]ã€‚", stats: { build: 244, farm: 68, make: 198, money: 47, adv: 172 }, }, 
            "å§¬è”": { rank: "ä¾¯", talent: "åœ¨[é¤Šé´¨å ´ã€é¤Šè±¬å ´ã€ç¾Šåœˆ]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[5%]é€²åº¦ã€‚", stats: { build: 360, farm: 244, make: 68, money: 131, adv: 360 }, }, 
            "æ™‚é—–": { rank: "ä¾¯", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œå»ºé€ ã€ä¿®å¾©ç‰©é«”é«”åŠ›æ¶ˆè€—æ¸›å°‘[15%]ï¼Œä¸”é«”åŠ›æ¢å¾©é€Ÿåº¦åŠ å¿«[15%]ã€‚", stats: { build: 411, farm: 70, make: 79, money: 175, adv: 426 }, }, 
            "ç‹„é’": { rank: "ä¾¯", talent: "åœ¨[æ™šä¸Š]å·¥ä½œæ™‚ï¼Œè¾²ç‰§å±¬æ€§è®Šç‚º[1.2å€]ã€‚", stats: { build: 218, farm: 218, make: 133, money: 382, adv: 248 }, }, 
            "è˜­é™µç¬‘ç¬‘ç”Ÿ": { rank: "ä¾¯", talent: "åœ¨[æ›¸å±€]å·¥ä½œæ™‚ï¼Œä¸éœ€èŠ±è²»éŠ…éŒ¢ï¼Œåè€Œç²å¾—[150%]éŠ…éŒ¢æ”¶å…¥ã€‚", stats: { build: 51, farm: 257, make: 161, money: 356, adv: 51 }, }, 
            "ç§¦è‰¯ç‰": { rank: "ä¾¯", talent: "åœ¨[é»åœŸç¤¦]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[20ä»½]é»åœŸã€‚", stats: { build: 65, farm: 429, make: 602, money: 607, adv: 435 }, }, 
            "è¶™æ˜èª ": { rank: "ä¾¯", talent: "è² è²¬[å»ºé€ æ–°å»ºç¯‰]æ™‚ï¼Œæ¸›å°‘éŠ…éŒ¢èŠ±è²»[10%]ã€‚", stats: { build: 340, farm: 238, make: 143, money: 59, adv: 167 }, }, 
            "æ—å¥´å…’": { rank: "ä¾¯", talent: "åœ¨[æ¼å…·åº—]å·¥ä½œæ™‚ï¼ŒéŠ…éŒ¢æ”¶å…¥æå‡[50%]ã€‚", stats: { build: 148, farm: 148, make: 248, money: 549, adv: 60 }, }, 
            "æˆšç¹¼å…‰": { rank: "å¤©", talent: "è² è²¬[å€‰åŸä½ˆé˜²]ä»»æ„å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[10%]é€²åº¦ï¼Œä¸”[ç„¡éœ€]é¡å¤–å·¥äººã€‚", stats: { build: 614, farm: 610, make: 424, money: 435, adv: 780 }, },
            "æå•†éš±": { rank: "å¤©", talent: "è² è²¬2å°æ™‚ä»¥ä¸Š[ç†è²¡]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[20%]é€²åº¦ï¼Œä¸¦éš¨æ©Ÿç²å¾—[30ä»½]è³‡æºã€‚", stats: { build: 88, farm: 612, make: 438, money: 778, adv: 422 }, },
            "ç™¾é‡Œå®‰": { rank: "å¤©", talent: "åœ¨[å•†æ¥­å»ºç¯‰]ä¸­è² è²¬2å°æ™‚ä»¥ä¸Šå·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[20ä»½]ç“·å™¨ã€ç‰å™¨æˆ–è¶Šç“·ã€‚", stats: { build: 246, farm: 437, make: 777, money: 790, adv: 240 }, },
            "ç™¾é‡Œæ²‰é¦™": { rank: "å¤©", talent: "åœ¨[é¦™ç²‰å» ]å·¥ä½œæ™‚ï¼Œæ‰€éœ€èŠ±ç“£æ¸›å°‘[20%]ï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 66, farm: 778, make: 794, money: 241, adv: 88 }, },
            "é¦¬è“¬ç€›": { rank: "å¤©", talent: "è² è²¬[è¾²ç‰§]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[20%]é€²åº¦ï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 433, farm: 794, make: 241, money: 247, adv: 95 }, },
            "æŸ³æ°¸": { rank: "å¤©", talent: "[å»ºé€ å¨›æ¨‚å»ºç¯‰]æ™‚ï¼Œæ‰€éœ€è³‡æºæ¶ˆè€—æ¸›å°‘[10%]ï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 794, farm: 88, make: 438, money: 247, adv: 608 }, },
            "é¦¬é é“": { rank: "å¤©", talent: "åœ¨[ç¢¼é ­]è² è²¬èˆ¹é‹æ™‚ï¼Œç«‹å³å®Œæˆ[15%]é€²åº¦ï¼Œä¸”é‹è¼¸å»ºç¯‰æ‰€éœ€èœé¤šæ¸›å°‘[30%]ã€‚", stats: { build: 422, farm: 612, make: 247, money: 608, adv: 794 }, },
            "å¾å¦™é›²": { rank: "å¤©", talent: "è² è²¬[ä»»æ„å·¥ä½œ]æ™‚ï¼Œç«‹å³å®Œæˆ[5%]é€²åº¦ï¼Œä¸”èˆ‡æœ±æ££å…¥ä½åŒåŸå¸‚æ™‚ï¼Œé›™æ–¹è² è²¬å·¥ä½œæ™‚çš„å±¬æ€§è®Šç‚º[1.1å€]ã€‚", stats: { build: 607, farm: 777, make: 432, money: 611, adv: 255 }, },
            "æ±æ–¹ç¥š": { rank: "å¤©", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œæ¡é›†ç¤¦çŸ³é«”åŠ›æ¶ˆè€—[-50%]ï¼Œä¸¦é¡å¤–ç²å¾—1å€‹éš¨æ©Ÿç¤¦ç‰©ã€‚", stats: { build: 247, farm: 256, make: 608, money: 88, adv: 791 }, },
            "é¡§å°ä¹": { rank: "å¤©", talent: "è² è²¬2å°æ™‚ä»¥ä¸Š[è£½ä½œ]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[2å€‹]å®…é‚¸å‚¢ä¿±ææ–™ï¼Œä¸”æ‰€éœ€å·¥äºº[-2]ã€‚", stats: { build: 608, farm: 256, make: 794, money: 438, adv: 612 }, },
            "ç›§ç’€": { rank: "å¤©", talent: "è² è²¬1å°æ™‚ä»¥ä¸Š[è¾²ç‰§]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[10%]é€²åº¦ï¼Œä¸¦éš¨æ©Ÿç²å¾—[20ä»½]è³‡æºã€‚", stats: { build: 609, farm: 795, make: 439, money: 257, adv: 242 }, },
            "ç‹ç¦": { rank: "å¤©", talent: "è² è²¬[è¾²ç‰§]å·¥ä½œæ™‚ï¼Œæ¯æœ‰ä¸€å€‹å·¥äººï¼Œé¡å¤–ç²å¾—10%è³‡æºã€‚", stats: { build: 434, farm: 779, make: 609, money: 257, adv: 89 }, }, 
            "å³æ‰¿æ©": { rank: "å¤©", talent: "è² è²¬2å°æ™‚ä»¥ä¸Š[è£½ä½œ]å·¥ä½œæ™‚ï¼Œéš¨æ©Ÿç²å¾—[50]ä»½è³‡æºï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 65, farm: 437, make: 793, money: 65, adv: 790 }, }, 
            "è¬åƒå±±": { rank: "å¤©", talent: "è² è²¬[å»ºé€ ]å·¥ä½œæ™‚ï¼Œæ¯æœ‰ä¸€å€‹ç”·æ€§å·¥äººï¼Œç«‹å³å®Œæˆ[2%]é€²åº¦ã€‚", stats: { build: 791, farm: 256, make: 438, money: 256, adv: 608 }, }, 
            "ç‹æ˜­å›": { rank: "å¤©", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œåªæ¶ˆè€—[0.6ä»½]ç³§è‰ã€‚", stats: { build: 97, farm: 243, make: 793, money: 243, adv: 793 }, }, 
            "å‘æ–œé™½": { rank: "å¤©", talent: "è² è²¬1å°æ™‚ä»¥ä¸Š[è£½ä½œ]æ™‚ï¼Œæœ‰[8%]æ©Ÿç‡ç«‹å³å®Œæˆï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 247, farm: 608, make: 778, money: 433, adv: 66 }, }, 
            "ç„å¥˜": { rank: "å¤©", talent: "è² è²¬[ä»»æ„å·¥ä½œ]æ™‚ï¼Œèœé¤šéœ€æ±‚[-30%]ï¼Œé©…é€é¬¼æ€ªæ™‚ï¼Œç«‹å³å®Œæˆ[15%]é€²åº¦ã€‚", stats: { build: 614, farm: 780, make: 424, money: 243, adv: 796 }, }, 
            "å¾ç¦å¿": { rank: "å¤©", talent: "åœ¨[å•†æ¥­å»ºç¯‰]ä¸­è² è²¬3å°æ™‚ä»¥ä¸Šå·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[30%]é€²åº¦ï¼Œä¸”æ‰€éœ€å·¥äºº[-2]ã€‚", stats: { build: 780, farm: 440, make: 243, money: 793, adv: 97 }, }, 
            "æ¥Šå«¿": { rank: "å¤©", talent: "è² è²¬2å°æ™‚ä»¥ä¸Š[è¾²ç‰§]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[10%]é€²åº¦ï¼Œä¸¦é¡å¤–ç²å¾—[100%]è³‡æºã€‚", stats: { build: 247, farm: 778, make: 433, money: 612, adv: 608 }, }, 
            "å¼µå±±æ­¸": { rank: "å¤©", talent: "æ¢ç´¢[æ–°å€åŸŸ]æ™‚ï¼Œç«‹å³å®Œæˆ[15%]é€²åº¦ï¼Œä¸”é™¤éŠ…éŒ¢å¤–çš„å…¶ä»–è³‡æºåŠé“å…·æ¶ˆè€—æ¸›å°‘[10%]ã€‚", stats: { build: 434, farm: 613, make: 609, money: 248, adv: 779 }, }, 
            "å¥¢é¦™": { rank: "å¤©", talent: "[å»ºé€ æ–°å•†æ¥­å»ºç¯‰]æ™‚ï¼Œéš¨æ©Ÿç²å¾—[30]ä»½è³‡æºï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 790, farm: 777, make: 246, money: 94, adv: 607 }, }, 
            "è˜‡è»¾": { rank: "å¤©", talent: "è² è²¬[è£½ä½œ]å·¥ä½œæ™‚ï¼Œè‚‰é¡éœ€æ±‚[-50%]ï¼Œä¸”æ‰€éœ€å·¥äºº[-2]ã€‚", stats: { build: 249, farm: 67, make: 783, money: 797, adv: 612 }, }, 
            "æ²ˆæ‹¬": { rank: "å¤©", talent: "è² è²¬[è¾²ç‰§]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[100%]è³‡æºï¼Œä½†æ‰€éœ€å·¥äºº[+1]ã€‚", stats: { build: 431, farm: 792, make: 776, money: 93, adv: 93 }, }, 
            "ä¸Šå®˜å©‰å…’": { rank: "å¤©", talent: "åœ¨[æ›¸å±€]æˆ–[å°åˆ·å» ]å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[15%]é€²åº¦ï¼Œä¸¦é¡å¤–ç²å¾—[40%]è³‡æºæˆ–é“å…·ã€‚", stats: { build: 437, farm: 240, make: 607, money: 777, adv: 421 }, }, 
            "æ²ˆåº¦": { rank: "å¤©", talent: "è² è²¬[è£½ä½œ]å·¥ä½œæ™‚ï¼Œæœ‰[5%]æ©Ÿç‡ç«‹å³å®Œæˆã€ä¸”æ‰€éœ€å·¥äºº[-2]ã€‚", stats: { build: 243, farm: 68, make: 796, money: 780, adv: 90 }, }, 
            "ä»‡è‹±": { rank: "å¤©", talent: "è² è²¬[è£½ä½œ]ã€[è¾²ç‰§]å·¥ä½œæ™‚ï¼Œå¦‚å·¥äººç¸½æ•¸ç‚ºé›™æ•¸ï¼Œå‰‡é¡å¤–ç²å¾—[150%]è³‡æºã€‚", stats: { build: 437, farm: 87, make: 793, money: 607, adv: 421 }, }, 
            "å–¬æºªåˆ": { rank: "å¤©", talent: "åœ¨ç”¨æ²™å ¡çš„æŠµç¦¦æ€ªç‰©ä¸­è² è²¬ä»»æ„å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[25%]é€²åº¦ã€‚", stats: { build: 607, farm: 255, make: 607, money: 432, adv: 793 }, }, 
            "å±ˆåŸ": { rank: "å¤©", talent: "è² è²¬1å°æ™‚ä»¥ä¸Š[è¾²ç‰§]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[80ä»½]èœé¤šï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 610, farm: 780, make: 614, money: 90, adv: 435 }, }, 
            "å­Ÿé¤˜": { rank: "å¤©", talent: "è² è²¬[è£½ä½œ]å·¥ä½œæ™‚ï¼Œä¸æ¶ˆè€—èœé¤šï¼Œåè€Œç²å¾—[100%]èœé¤šï¼Œä¸”æ‰€éœ€å·¥äºº[-2]ã€‚", stats: { build: 96, farm: 434, make: 779, money: 613, adv: 257 }, }, 
            "éº¥å°æ»¿": { rank: "å¤©", talent: "è² è²¬æšå·[æ¼•é‹]ä»»æ„å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[10%]é€²åº¦ï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 257, farm: 439, make: 257, money: 609, adv: 779 }, }, 
            "å­Ÿå¥½å­¸": { rank: "å¤©", talent: "[å»ºé€ æˆ–å‡ç´šå»ºç¯‰]æ™‚ï¼Œé™¤èœé¤šå¤–å…¶ä»–æ‰€æœ‰è³‡æºèŠ±è²»æ¸›å°‘[10%]ï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 795, farm: 67, make: 792, money: 248, adv: 67 }, }, 
            "æŸ³ç¬‘ç¿": { rank: "å¤©", talent: "åœ¨[å•†æ¥­å»ºç¯‰]å·¥ä½œæ™‚ï¼Œæœ‰[5%]æ©Ÿç‡ç«‹å³å®Œæˆï¼Œä¸”æ‰€éœ€æœ¬é‡‘æ¸›å°‘[30%]ã€‚", stats: { build: 257, farm: 609, make: 439, money: 779, adv: 613 }, }, 
            "ç¾…ç´ æœˆ": { rank: "å¤©", talent: "åœ¨[ç…‰ä¸¹çˆ]å·¥ä½œæ™‚ï¼Œæ‰€éœ€è‰è—¥æ¸›å°‘[30%]ã€æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 423, farm: 609, make: 792, money: 439, adv: 434 }, }, 
            "ææ¸…ç…§": { rank: "å¤©", talent: "åœ¨[å•†æ¥­å»ºç¯‰]ä¸­å·¥ä½œæ™‚ï¼ŒéŠ…éŒ¢æ”¶å…¥æå‡[50%]ã€æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 440, farm: 610, make: 424, money: 796, adv: 243 }, }, 
            "æç…œ": { rank: "å¤©", talent: "åœ¨åŸå¸‚ä¸­è² è²¬1å°æ™‚ä»¥ä¸Š[è£½ä½œ]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[80%]è³‡æºã€éš¨æ©Ÿç²å¾—[3æœ¬]æ›¸ç±ã€‚", stats: { build: 608, farm: 66, make: 794, money: 256, adv: 612 }, },
            "åŠ‰æ¡æ˜¥": { rank: "å¤©", talent: "è² è²¬2å°æ™‚ä»¥ä¸Šçš„[è¾²ç‰§]å·¥ä½œæ™‚ï¼Œä¸€èµ·å·¥ä½œçš„åŒä¼´æ¯æœ‰ä¸€ä½å¥³æ€§ï¼Œé¡å¤–ç²å¾—[40ä»½]èœé¤šã€‚", stats: { build: 434, farm: 779, make: 248, money: 96, adv: 609 }, }, 
            "æç™½": { rank: "å¤©", talent: "å¤–å‡º[æ¢éšª]æ™‚ï¼Œæ¡é›†æ‰€æœ‰ç‰©é«”çš„é«”åŠ›æ¶ˆè€—[-8]ã€‚", stats: { build: 607, farm: 607, make: 607, money: 432, adv: 790 }, }, 
            "å§œå–œ": { rank: "å¤©", talent: "è² è²¬[è£½ä½œ]ã€[è¾²ç‰§]å·¥ä½œæ™‚ï¼Œå¦‚å·¥äººç¸½æ•¸ç‚ºé›™æ•¸ï¼Œå‰‡é¡å¤–ç²å¾—[150%]è³‡æºã€‚", stats: { build: 257, farm: 609, make: 795, money: 423, adv: 248 }, }, 
            "æ±Ÿè¡Œ": { rank: "å¤©", talent: "åœ¨åŸå¸‚ä¸­è² è²¬1å°æ™‚ä»¥ä¸Šçš„[å»ºé€ ]å·¥ä½œï¼Œéš¨æ©Ÿç²å¾—[40ä»½]è³‡æºï¼Œä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 792, farm: 609, make: 257, money: 96, adv: 434 }, }, 
            "ç´…æ‹‚": { rank: "å¤©", talent: "[æ¢ç´¢æ–°å€åŸŸ]æ™‚ï¼Œç«‹å³å®Œæˆ[15%]é€²åº¦ï¼Œä¸”æœ‰[10%]æ©Ÿç‡ç„¡éœ€éŠ…éŒ¢ã€‚", stats: { build: 607, farm: 246, make: 246, money: 421, adv: 793 }, }, 
            "å…¬å­«ç­–": { rank: "å¤©", talent: "åœ¨åŸå¸‚ä¸­è² è²¬[è£½ä½œ]å·¥ä½œæ™‚ï¼Œæ¯æœ‰1å€‹å·¥äººï¼Œé¡å¤–ç²å¾—[50ä»½]èœé¤šã€‚", stats: { build: 438, farm: 247, make: 778, money: 256, adv: 608 }, }, 
            "å…¬å­«èº": { rank: "å¤©", talent: "[æ¢ç´¢æ–°å€åŸŸ]æ™‚ï¼Œéœ€è¦æœ¬é‡‘æ¸›å°‘[10%]ï¼Œä¸”æ‰€éœ€å·¥äºº[-2]ã€‚", stats: { build: 95, farm: 241, make: 612, money: 256, adv: 778 }, }, 
            "å¤©æ©Ÿå­": { rank: "å¤©", talent: "åœ¨[ç”Ÿç”¢]æˆ–[å•†æ¥­å»ºç¯‰]ä¸­è² è²¬1å°æ™‚ä»¥ä¸Šå·¥ä½œï¼Œéš¨æ©Ÿç²å¾—[15ä»½]è³‡æºï¼Œä¸”æ‰€éœ€å·¥äºº[-2]ã€‚", stats: { build: 439, farm: 795, make: 613, money: 609, adv: 67 }, }, 
            "é“æ¿Ÿ": { rank: "å¤©", talent: "è² è²¬[è£½ä½œ]å·¥ä½œæ™‚ï¼Œé¡å¤–ç²å¾—[170%]è³‡æºï¼›ä½†åšä»»æ„å·¥ä½œæ™‚ï¼Œéƒ½æœ‰[15%]æ©Ÿç‡ä¸æƒ³å»å·¥ä½œã€‚", stats: { build: 247, farm: 438, make: 791, money: 88, adv: 608 }, }, 
            "æˆé³³ç¾½": { rank: "å¤©", talent: "[å»ºé€ å¨›æ¨‚å»ºç¯‰]æ™‚ï¼Œæ‰€éœ€è³‡æºæ¶ˆè€—æ¸›å°‘[10%]ï¼Œä¸¦ç«‹å³å®Œæˆ[10%]é€²åº¦ã€‚", stats: { build: 794, farm: 438, make: 778, money: 256, adv: 422 }, }, 
            "ç¨‹å¤§ä½": { rank: "å¤©", talent: "è² è²¬[å¾½å•†]ç¶“ç‡Ÿæ™‚ï¼Œç«‹å³å®Œæˆ[10%]é€²åº¦ï¼Œä¸¦é¡å¤–ç²å¾—[300]å®¶æ—è³‡é‡‘ã€‚", stats: { build: 247, farm: 256, make: 433, money: 794, adv: 791 }, }, 
            "è¶™å­Ÿç©": { rank: "ä¾¯", talent: "è² è²¬[æ¶ˆè€—ç´™æˆ–å¾½å¢¨]çš„å»ºé€ å·¥ä½œæ™‚ï¼Œç«‹å³å®Œæˆ[20%]é€²åº¦ï¼›èˆ‡[ç®¡é“æ˜‡]å…¥ä½åŒåŸå¸‚ï¼Œé›™æ–¹è² è²¬å·¥ä½œæ™‚çš„å±¬æ€§è®Šç‚º[1.1]å€ã€‚", stats: { build: 387, farm: 270, make: 224, money: 563, adv: 64 }, }, 
            "åŒ…æ‹¯": { rank: "å¤©", talent: "è² è²¬[å»ºé€ ]æ™‚ï¼ŒèŠ±è²»çš„æ‰€æœ‰è³‡æºæ¸›å°‘[10%]ï¼Œä½†å»ºé€ æ™‚é–“å¢åŠ [10%]ã€‚ä¸”æ‰€éœ€å·¥äºº[-1]ã€‚", stats: { build: 789, farm: 606, make: 610, money: 436, adv: 420 }, }, 
        };

        const cities = ["special_root", "æ‡‰å¤©", "è˜‡å·", "æ­å·", "æ¾æ±Ÿ", "å¾½å·", "ç´¹èˆˆ", "æšå·", "é›é³´"];
        let characters = [], masterBuildings = [], cityBuildings = {};
        let currentCity = "special_root", currentTab = "people", editingCharId = null;
        let tempDispatchCity = "æœªåˆ†é…", editingBuildIdx = null, distTargetIdx = null, selectedDistCities = [];
        let confirmCallback = null;

        function showToast(msg) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast'; toast.textContent = msg;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }

        function showConfirmCard(title, msg, callback) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-msg').textContent = msg;
            document.getElementById('confirm-overlay').classList.add('open');
            document.getElementById('confirm-card').classList.add('open');
            confirmCallback = callback;
        }

        function handleConfirm(result) {
            document.getElementById('confirm-overlay').classList.remove('open');
            document.getElementById('confirm-card').classList.remove('open');
            if(result && confirmCallback) confirmCallback();
            confirmCallback = null;
        }

        function init() { loadData(); renderCityTabs(); renderMainContent(); setupOverlayClick(); window.addEventListener('click', (e) => { const box = document.getElementById('suggestionBox'); if (e.target.id !== 'in-c-name' && e.target.id !== 'suggestionBox') box.style.display = 'none'; }); }

        function loadData() {
            characters = JSON.parse(localStorage.getItem('jiangnan_chars_v16') || '[]');
            masterBuildings = JSON.parse(localStorage.getItem('jiangnan_master_v16') || '[]');
            cityBuildings = JSON.parse(localStorage.getItem('jiangnan_cityb_v16') || '{}');
            cities.forEach(c => { if(c !== "special_root" && !cityBuildings[c]) cityBuildings[c] = []; });
        }

        function saveData() {
            localStorage.setItem('jiangnan_chars_v16', JSON.stringify(characters));
            localStorage.setItem('jiangnan_master_v16', JSON.stringify(masterBuildings));
            localStorage.setItem('jiangnan_cityb_v16', JSON.stringify(cityBuildings));
        }

        function setupOverlayClick() { document.querySelectorAll('.modal-overlay').forEach(overlay => { overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(overlay.id); }); }); }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const idx = { 'people': 0, 'city': 1, 'overview': 2 }[tab];
            document.querySelectorAll('.nav-item')[idx].classList.add('active');
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${tab}`).classList.add('active');
            if(tab === 'overview' && currentCity === 'special_root') currentCity = "æ‡‰å¤©";
            if(tab === 'city') currentCity = "special_root";
            renderCityTabs(); renderMainContent();
        }

        function renderCityTabs() {
            const container = document.getElementById('cityTabs'); container.innerHTML = '';
            const list = (currentTab === 'overview') ? cities.slice(1) : cities;
            list.forEach(city => {
                const btn = document.createElement('div');
                let name = city;
                if(city === "special_root") {
                    if(currentTab === 'people') name = "æœªåˆ†é¡";
                    else if(currentTab === 'city') name = "å€‰åº«";
                    else name = "æœªåˆ†é¡";
                }
                btn.className = `city-tab ${city === "special_root" ? 'special-tab' : ''} ${city === currentCity ? 'active' : ''}`;
                btn.textContent = name;
                btn.onclick = () => { currentCity = city; renderCityTabs(); renderMainContent(); };
                container.appendChild(btn);
            });
        }

        function renderMainContent() { if(currentTab === 'people') renderPeople(); else if(currentTab === 'city') renderCityInfo(); else renderOverview(); }

        function parseTalent(text) { return text ? text.replace(/\[(.*?)\]/g, '<span class="talent-hl">$1</span>') : "ç›®å‰ç„¡ç‰¹æ®Šèƒ½åŠ›è¨­å®š"; }

        // --- æ ¸å¿ƒä¿®æ”¹ï¼šå¢åŠ æ’åºé‚è¼¯ ---
        function renderPeople() {
            const search = document.getElementById('searchInput').value.trim();
            const container = document.getElementById('charList'); container.innerHTML = '';
            
            let filtered;
            if (search) {
                filtered = characters.filter(c => c.name.includes(search));
            } else {
                if (currentCity === "special_root") {
                    filtered = characters.filter(c => c.city === "æœªåˆ†é…");
                } else {
                    filtered = characters.filter(c => c.city === currentCity);
                }
            }

            // æŒ‰ç…§ å¤© > ä¾¯ > å¿ > å£« æ’åº
            const rankPriority = { "å¤©": 1, "ä¾¯": 2, "å¿": 3, "å£«": 4 };
            filtered.sort((a, b) => (rankPriority[a.rank] || 99) - (rankPriority[b.rank] || 99));

            filtered.forEach(char => {
                const card = document.createElement('div'); card.className = 'card-base char-card'; card.onclick = () => openEditCharModal(char.id);
                const s = char.stats; const isH = (k) => s[k]>=700?'stat-ultra':(s[k]>=600)?'stat-high':'';
                card.innerHTML = `<div class="card-header-row"><span class="char-name">${char.name}</span><div class="header-tags"><span class="rank-tag bg-${char.rank}">${char.rank}</span></div></div><div class="char-talent">${parseTalent(char.talent)}</div><div class="stats-row"><div class="stat-box"><span class="stat-label">å»º</span><span class="stat-val ${isH('build')}">${s.build}</span></div><div class="stat-box"><span class="stat-label">è¾²</span><span class="stat-val ${isH('farm')}">${s.farm}</span></div><div class="stat-box"><span class="stat-label">è£½</span><span class="stat-val ${isH('make')}">${s.make}</span></div><div class="stat-box"><span class="stat-label">ç†</span><span class="stat-val ${isH('money')}">${s.money}</span></div><div class="stat-box"><span class="stat-label">æ¢</span><span class="stat-val ${isH('adv')}">${s.adv}</span></div></div>`;
                container.appendChild(card);
            });
        }

        function handleNameInput() {
            const val = document.getElementById('in-c-name').value.trim();
            const box = document.getElementById('suggestionBox'); box.innerHTML = '';
            if(!val) { box.style.display = 'none'; return; }
            const matches = Object.keys(charDB).filter(n => n.includes(val));
            matches.forEach(m => {
                const item = document.createElement('div'); item.className = 'suggestion-item';
                item.innerHTML = `<span>${m}</span><span style="font-size:0.75rem; color:#8e8e93;">${charDB[m].rank}</span>`;
                item.onclick = () => {
                    const d = charDB[m]; document.getElementById('in-c-name').value = m;
                    document.getElementById('in-c-rank').value = d.rank; document.getElementById('in-c-talent').value = d.talent || "";
                    if(d.stats) Object.keys(d.stats).forEach(k => document.getElementById(`in-c-${k}`).value = d.stats[k]);
                    box.style.display = 'none';
                };
                box.appendChild(item);
            });
            box.style.display = matches.length > 0 ? 'block' : 'none';
        }

        function openAddCharModal() { editingCharId = null; tempDispatchCity = "æœªåˆ†é…"; document.getElementById('charModalTitle').textContent = "æ–°å¢äººç‰©"; document.getElementById('in-c-name').value = ''; document.getElementById('in-c-talent').value = ''; ['build','farm','make','money','adv'].forEach(k => document.getElementById(`in-c-${k}`).value = ''); document.getElementById('btn-delete-char').style.display = 'none'; renderModalCities(); document.getElementById('charModal').classList.add('open'); }
        function openEditCharModal(id) { editingCharId = id; const char = characters.find(c => c.id === id); tempDispatchCity = char.city; document.getElementById('charModalTitle').textContent = "ç·¨è¼¯äººç‰©"; document.getElementById('in-c-name').value = char.name; document.getElementById('in-c-rank').value = char.rank; document.getElementById('in-c-talent').value = char.talent || ""; Object.keys(char.stats).forEach(k => document.getElementById(`in-c-${k}`).value = char.stats[k]); renderModalCities(); document.getElementById('btn-delete-char').style.display = 'block'; document.getElementById('charModal').classList.add('open'); }
        
        function saveChar() {
            const name = document.getElementById('in-c-name').value.trim();
            if(!name) return showToast("âš ï¸ è«‹è¼¸å…¥å§“å");
            const isDuplicate = characters.some(c => c.name === name && c.id !== editingCharId);
            if (isDuplicate) return showToast(`âš ï¸ ã€Œ${name}ã€å·²åœ¨åå†Šä¸­`);

            const data = {
                name, rank: document.getElementById('in-c-rank').value, talent: document.getElementById('in-c-talent').value, city: tempDispatchCity,
                stats: {
                    build: parseInt(document.getElementById('in-c-build').value)||0, farm: parseInt(document.getElementById('in-c-farm').value)||0,
                    make: parseInt(document.getElementById('in-c-make').value)||0, money: parseInt(document.getElementById('in-c-money').value)||0, adv: parseInt(document.getElementById('in-c-adv').value)||0
                }
            };
            if(editingCharId) characters[characters.findIndex(c => c.id === editingCharId)] = { id: editingCharId, ...data };
            else characters.push({ id: Date.now(), ...data });
            saveData(); closeModal('charModal'); renderMainContent(); showToast("âœ… å„²å­˜æˆåŠŸ");
        }

        function askDeleteChar() { showConfirmCard("åˆªé™¤äººç‰©", "ç¢ºå®šè¦åˆªé™¤é€™ä½è§’è‰²å—ï¼Ÿ", () => { characters = characters.filter(c => c.id !== editingCharId); saveData(); closeModal('charModal'); renderMainContent(); showToast("ğŸ—‘ï¸ å·²åˆªé™¤"); }); }
        function renderModalCities() {
            const container = document.getElementById('modalCityGrid'); container.innerHTML = '';
            ["æœªåˆ†é…", ...cities.slice(1)].forEach(c => {
                const btn = document.createElement('button'); btn.className = `dispatch-btn ${c === tempDispatchCity ? 'selected' : ''}`; btn.textContent = c; btn.onclick = () => { tempDispatchCity = c; renderModalCities(); }; container.appendChild(btn);
            });
        }

        function renderCityInfo() {
            const isWarehouse = (currentCity === "special_root");
            document.getElementById('addBuildBtn').style.display = isWarehouse ? 'block' : 'none';
            document.getElementById('build-subtitle').textContent = isWarehouse ? "å»ºç¯‰å€‰åº«" : `${currentCity} å»ºç¯‰æ¸…å–®`;
            const container = document.getElementById('buildingList'); container.innerHTML = '';
            let list = isWarehouse ? masterBuildings : (cityBuildings[currentCity] || []);
            list.forEach((b, idx) => {
                const card = document.createElement('div'); card.className = `card-base building-card`;
                card.onclick = isWarehouse ? () => openEditBuildingModal(idx) : () => askDeleteCityBuilding(currentCity, idx);
                card.innerHTML = `<div class="b-color-strip" style="background:${b.color||'#ddd'}"></div><div class="b-info"><span class="b-name">${b.name}</span><span class="b-desc">${b.desc}</span></div>${isWarehouse?`<button class="btn-distribute" onclick="event.stopPropagation(); openDistributeModal(${idx})"><span class="material-symbols-outlined">add_location_alt</span>åˆ†é…</button>`:''}`;
                container.appendChild(card);
            });
        }

        function askDeleteCityBuilding(city, idx) {
            const b = cityBuildings[city][idx];
            showConfirmCard("æ‹†é™¤å»ºç¯‰", `ç¢ºå®šè¦æ‹†é™¤ ${city} çš„ ${b.name} å—ï¼Ÿ`, () => { cityBuildings[city].splice(idx, 1); saveData(); renderOverview(); renderCityInfo(); showToast("ğŸ—‘ï¸ å»ºç¯‰å·²æ‹†é™¤"); });
        }

        function openAddBuildingModal() { editingBuildIdx = null; document.getElementById('in-b-name').value = ""; document.getElementById('in-b-desc').value = ""; document.getElementById('in-b-color').value = "#5dabff"; document.getElementById('color-circle').style.background = "#5dabff"; document.getElementById('btn-delete-build').style.display = 'none'; document.getElementById('buildingModal').classList.add('open'); }
        function openEditBuildingModal(idx) { editingBuildIdx = idx; const b = masterBuildings[idx]; document.getElementById('in-b-name').value = b.name; document.getElementById('in-b-desc').value = b.desc; document.getElementById('in-b-color').value = b.color; document.getElementById('color-circle').style.background = b.color; document.getElementById('btn-delete-build').style.display = 'block'; document.getElementById('buildingModal').classList.add('open'); }
        function saveMasterBuilding() { const name = document.getElementById('in-b-name').value; if(!name) return; const bData = { name, color: document.getElementById('in-b-color').value, desc: document.getElementById('in-b-desc').value }; if(editingBuildIdx !== null) masterBuildings[editingBuildIdx] = bData; else masterBuildings.push(bData); saveData(); closeModal('buildingModal'); renderCityInfo(); }
        function askDeleteBuild() { showConfirmCard("é€£é–åˆªé™¤", "ç¢ºå®šè¦åˆªé™¤å€‰åº«åŸå‹å—ï¼Ÿå„åŸå¸‚çš„åŒåå»ºç¯‰å°‡ä¸€ä½µè¢«æ‹†é™¤ï¼", () => { const targetName = masterBuildings[editingBuildIdx].name; masterBuildings.splice(editingBuildIdx, 1); for (let c in cityBuildings) { cityBuildings[c] = cityBuildings[c].filter(b => b.name !== targetName); } saveData(); closeModal('buildingModal'); renderCityInfo(); showToast("ğŸ—‘ï¸ å·²é€£é–æ¸…é™¤"); }); }

        function openDistributeModal(idx) { distTargetIdx = idx; selectedDistCities = []; const container = document.getElementById('distCityGrid'); container.innerHTML = ''; cities.slice(1).forEach(city => { const btn = document.createElement('button'); btn.className = 'dispatch-btn'; btn.textContent = city; btn.onclick = () => { if(selectedDistCities.includes(city)) selectedDistCities = selectedDistCities.filter(c => c !== city); else selectedDistCities.push(city); btn.classList.toggle('selected'); }; container.appendChild(btn); }); document.getElementById('distributeModal').classList.add('open'); }
        function confirmDistribution() { if(selectedDistCities.length === 0) return; const b = masterBuildings[distTargetIdx]; selectedDistCities.forEach(city => { if(!cityBuildings[city]) cityBuildings[city] = []; cityBuildings[city].push({...b}); }); saveData(); closeModal('distributeModal'); showToast(`ğŸ—ï¸ åˆ†é…å®Œæˆ`); }

        function toggleOvSection(sectionId, headerEl) {
            const content = document.getElementById(sectionId);
            const isCollapsed = content.classList.toggle('collapsed');
            headerEl.classList.toggle('ov-divider-collapsed', isCollapsed);
        }

        function renderOverview() {
            const container = document.getElementById('overview-content');
            const isUnassigned = (currentCity === "special_root");
            const pList = isUnassigned ? characters.filter(c => c.city === "æœªåˆ†é…") : characters.filter(c => c.city === currentCity);
            const bList = cityBuildings[currentCity] || [];

            // æŒ‰ç…§ å¤© > ä¾¯ > å¿ > å£« æ’åº
            const rankPriority = { "å¤©": 1, "ä¾¯": 2, "å¿": 3, "å£«": 4 };
            pList.sort((a, b) => (rankPriority[a.rank] || 99) - (rankPriority[b.rank] || 99));

            let html = `
                <div class="overview-divider" onclick="toggleOvSection('ov-p-content', this)">é§ç´®å®˜å“¡ <span class="ov-count-tag">${pList.length} äºº</span><span class="material-symbols-outlined ov-toggle-icon">expand_more</span></div>
                <div class="ov-collapsible-content" id="ov-p-content"><div class="ov-char-grid" id="ov-p"></div></div>
            `;
            if (!isUnassigned) {
                html += `
                    <div class="overview-divider" onclick="toggleOvSection('ov-b-content', this)">åŸå…§å»ºç¯‰ <span class="ov-count-tag">${bList.length} åº§</span><span class="material-symbols-outlined ov-toggle-icon">expand_more</span></div>
                    <div class="ov-collapsible-content" id="ov-b-content"><div class="ov-build-grid" id="ov-b"></div></div>
                `;
            }
            container.innerHTML = html;

            pList.forEach(char => {
                const card = document.createElement('div'); card.className = 'card-base char-card ov-char-card'; card.onclick = () => openEditCharModal(char.id);
                card.innerHTML = `<div class="card-header-row"><span class="char-name">${char.name}</span><span class="rank-tag bg-${char.rank}">${char.rank}</span></div><div class="char-talent">${parseTalent(char.talent)}</div>`;
                document.getElementById('ov-p').appendChild(card);
            });
            if (!isUnassigned) {
                bList.forEach((b, idx) => {
                    const card = document.createElement('div'); card.className = 'card-base building-card ov-build-card'; card.onclick = () => askDeleteCityBuilding(currentCity, idx);
                    card.innerHTML = `<div class="b-color-strip" style="background:${b.color||'#ddd'}"></div><div class="b-info"><span class="b-name">${b.name}</span></div>`;
                    document.getElementById('ov-b').appendChild(card);
                });
            }
        }

        function openDataModal() { document.getElementById('data-area').value = JSON.stringify({ characters, masterBuildings, cityBuildings }); document.getElementById('dataModal').classList.add('open'); }
        function copyData() { document.getElementById('data-area').select(); document.execCommand('copy'); showToast("ğŸ“‹ æ•¸æ“šå·²è¤‡è£½"); }
        function importData() { showConfirmCard("é‚„åŸæ•¸æ“š", "ç¢ºå®šè¦è¦†è“‹å—ï¼Ÿ", () => { try { const d = JSON.parse(document.getElementById('data-area').value); characters = d.characters; masterBuildings = d.masterBuildings; cityBuildings = d.cityBuildings; saveData(); location.reload(); } catch(e) { showToast("âŒ è§£æå¤±æ•—"); } }); }
        function closeModal(id) { document.getElementById(id).classList.remove('open'); editingBuildIdx = null; }

        init();
    </script>
</body>
</html>
